# Generated by Django 4.2.3 on 2023-07-31 06:01

from django.db import migrations, models


def migrate_categories_to_category(apps, schema_editor):
    VulnerabilityTemplate = apps.get_model('backend', 'VulnerabilityTemplate')
    ProjectVulnerability = apps.get_model('backend', 'ProjectVulnerability')
    for template in list(VulnerabilityTemplate.objects.all()) + list(ProjectVulnerability.objects.all()):
        if template.categories.count() < 1:
            continue
        category = template.categories.all()[0]
        template.category = category.pk
        template.save()


class Migration(migrations.Migration):
    dependencies = [
        ('backend', '0011_usersettings_notify_critical_findings'),
    ]

    operations = [
        migrations.AddField(
            model_name='projectvulnerability',
            name='category',
            field=models.PositiveSmallIntegerField(null=True, verbose_name='backend.VulnerabilityCategory'),
        ),
        migrations.AddField(
            model_name='vulnerabilitytemplate',
            name='category',
            field=models.PositiveSmallIntegerField(null=True, verbose_name='backend.VulnerabilityCategory'),
        ),
        migrations.RunPython(migrate_categories_to_category),
        migrations.AlterField(
            model_name="vulnerabilitytemplate",
            name="category",
            field=models.ForeignKey('backend.VulnerabilityCategory', on_delete=models.PROTECT)
        ),
        migrations.AlterField(
            model_name="projectvulnerability",
            name="category",
            field=models.ForeignKey('backend.VulnerabilityCategory', on_delete=models.PROTECT)
        ),
        migrations.RemoveField(
            model_name='projectvulnerability',
            name='categories',
        ),
        migrations.RemoveField(
            model_name='vulnerabilitytemplate',
            name='categories',
        ),
    ]
